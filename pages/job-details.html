<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="icon" type="image/png" href="../assets/img/favicon.png">
  <title>Job Details | Naivik</title>
  
  <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Inter:300,400,500,600,700,900" />
  <link href="../assets/css/nucleo-icons.css" rel="stylesheet" />
  <link href="../assets/css/nucleo-svg.css" rel="stylesheet" />
  <script src="https://kit.fontawesome.com/42d5adcbca.js" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0" />
  <link id="pagestyle" href="../assets/css/material-kit.css?v=3.1.0" rel="stylesheet" />

  <!-- -------- IMPORTING SUPABASE ------- -->  
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    :root {
      --baby-blue: #89CFF0;
      --deep-black: #000000;
    }

    /* Hero Section (Dark Mode) */
    .bg-job-hero {
      background: linear-gradient(135deg, #000000 0%, #0a192f 100%);
      padding-top: 180px;
      padding-bottom: 80px;
      position: relative;
      overflow: hidden;
    }

    /* Content Body (High-Contrast White) */
    .job-content-section { background-color: #ffffff; color: #1e293b; }

    .text-baby-blue { color: var(--baby-blue) !important; }
    .bg-baby-blue { background-color: var(--baby-blue) !important; }
    
    .sidebar-card {
      border: 1px solid #e2e8f0;
      border-radius: 20px;
      background: #f8fafc;
      position: sticky;
      top: 100px;
    }

    .breadcrumb-item + .breadcrumb-item::before { color: #64748b; }
    
    .check-icon-blue {
      color: var(--baby-blue);
      font-size: 1.2rem;
      vertical-align: middle;
      margin-right: 8px;
    }

    .bg-splatter {
      position: absolute;
      width: 500px; height: 500px;
      background: radial-gradient(circle, rgba(137, 207, 240, 0.1) 0%, transparent 70%);
      filter: blur(60px);
      z-index: 0;
    }
  </style>
</head>

<body>
  <nav class="navbar navbar-expand-lg position-absolute top-0 z-index-3 w-100 shadow-none my-3 navbar-transparent">
    <div class="container">
      <a class="navbar-brand font-weight-bolder text-white tracking-widest text-uppercase" href="../../index.html">Naivik</a>
      <div class="ms-auto">
        <a href="careers.html" class="text-white small text-uppercase fw-bold text-decoration-none">
          <i class="material-symbols-rounded align-middle fs-6 me-1">arrow_back</i> Back to Jobs
        </a>
      </div>
    </div>
  </nav>

  <header class="bg-job-hero">
    <div class="bg-splatter" style="top: -10%; right: -5%;"></div>
    <div class="container position-relative z-index-1">
      <div class="row">
        <div class="col-lg-8">
          <nav aria-label="breadcrumb">
            <ol class="breadcrumb mb-4">
              <li class="breadcrumb-item"><a href="careers.html" class="text-baby-blue">Careers</a></li>
              <li class="breadcrumb-item active text-muted" id="breadcrumb-job-title">Job Details</li>
            </ol>
          </nav>
          <h1 class="text-white display-4 font-weight-bolder mb-3" id="main-job-title">Loading Job Title...</h1>
          <div class="d-flex flex-wrap gap-4 text-muted">
             <span id="hero-location"><i class="material-symbols-rounded align-bottom fs-6 me-1">location_on</i> Toronto, ON</span>
             <span id="hero-type"><i class="material-symbols-rounded align-bottom fs-6 me-1">work</i> Full-time</span>
          </div>
        </div>
      </div>
    </div>
  </header>

  <section class="job-content-section py-7">
    <div class="container">
      <div class="row">
        
        <div class="col-lg-8 pe-lg-6">
          <div id="job-long-description">
            <h4 class="fw-bold mb-4">About the Role</h4>
            <p class="lead text-muted mb-5" id="job-intro">Loading description...</p>
            
            <h5 class="fw-bold mb-4">What you'll do:</h5>
            <ul class="list-unstyled" id="job-responsibilities">
              </ul>

            <h5 class="fw-bold mt-5 mb-4">What you bring:</h5>
            <ul class="list-unstyled" id="job-requirements">
              </ul>
          </div>

          <div class="mt-6 p-5 bg-light rounded-4 border">
            <h4 class="fw-bold mb-3">Ready to transform with us?</h4>
            <p class="text-muted mb-4">Submit your resume and cover letter. If you have a portfolio or GitHub link, we'd love to see it.</p>
            <button class="btn bg-baby-blue text-white px-5 py-3">Apply for this position</button>
          </div>
        </div>

        <div class="col-lg-4 mt-5 mt-lg-0">
          <div class="sidebar-card p-4">
            <h6 class="text-uppercase text-muted fw-bold mb-4 small tracking-widest">Job Specifications</h6>
            
            <div class="mb-3">
              <label class="d-block text-xs text-uppercase text-muted fw-bold">Salary Range</label>
              <span class="fw-bold" id="side-salary">Negotiable</span>
            </div>
            <div class="mb-3">
              <label class="d-block text-xs text-uppercase text-muted fw-bold">Reference ID</label>
              <span class="text-muted" id="side-ref">#000000</span>
            </div>
            <div class="mb-3">
              <label class="d-block text-xs text-uppercase text-muted fw-bold">Date Posted</label>
              <span class="text-muted" id="side-date">March 18, 2025</span>
            </div>

            <hr class="my-4">
            
            <div class="d-grid gap-2">
              <button class="btn btn-dark w-100">Apply Now</button>
              <button class="btn btn-outline-secondary w-100">
                <i class="material-symbols-rounded align-middle fs-6 me-1">share</i> Share Job
              </button>
            </div>
          </div>
        </div>

      </div>
    </div>
  </section>

  <footer class="footer py-5 bg-black text-center border-top border-dark">
    <p class="text-muted mb-0">Â© Naivik Technologies. All rights reserved.</p>
  </footer>

  <script>
    const SUPABASE_URL = 'https://duiqfjsogpiadxhdmdqz.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImR1aXFmanNvZ3BpYWR4aGRtZHF6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc2NDM2NDQsImV4cCI6MjA4MzIxOTY0NH0.jyUwREEPhchkWDYX2y7M8WUNkvA94p_J2aiIgoirv8M';
    const naivikSupabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    async function loadJobDetails() {
      const urlParams = new URLSearchParams(window.location.search);
      const jobId = urlParams.get('id');

      if (!jobId) return;

      try {
        const { data: job, error } = await naivikSupabase
          .from('jobs')
          .select('*')
          .eq('id', jobId)
          .single();

        if (error || !job) {
          document.getElementById('job-long-description').innerHTML = "<h3>Job not found.</h3>";
          return;
        }

        // 1. Basic UI Population
        document.title = `${job.title} | Naivik`;
        document.getElementById('main-job-title').innerText = job.title;
        document.getElementById('breadcrumb-job-title').innerText = job.title;
        document.getElementById('hero-location').innerHTML = `<i class="material-symbols-rounded align-bottom fs-6 me-1">location_on</i> ${job.location}`;
        document.getElementById('hero-type').innerHTML = `<i class="material-symbols-rounded align-bottom fs-6 me-1">work</i> ${job.type}`;
        document.getElementById('job-intro').innerText = job.intro;
        document.getElementById('side-salary').innerText = job.salary;
        document.getElementById('side-ref').innerText = job.ref;
        document.getElementById('side-date').innerText = job.posted;

        // 2. Helper function to handle potential "null" or "string" instead of array
        const ensureArray = (data) => {
          if (Array.isArray(data)) return data; // Already an array, perfect
          if (typeof data === 'string') {
              // If it's a string from a CSV error, try to clean and split it
              return data.replace(/[{}]/g, '').split(',').map(s => s.trim());
          }
          return []; // Return empty if null/undefined
        };

        const responsibilities = ensureArray(job.responsibilities);
        const requirements = ensureArray(job.requirements);

        // 3. Populate Lists safely
        const respList = document.getElementById('job-responsibilities');
        if (responsibilities.length > 0) {
          respList.innerHTML = responsibilities.map(item => 
            `<li class="mb-3"><i class="material-symbols-rounded check-icon-blue">check_circle</i> ${item}</li>`
          ).join('');
        } else {
          respList.innerHTML = `<li class="text-muted">Contact us for more details on responsibilities.</li>`;
        }

        const reqList = document.getElementById('job-requirements');
        if (requirements.length > 0) {
          reqList.innerHTML = requirements.map(item => 
            `<li class="mb-3"><i class="material-symbols-rounded check-icon-blue">check_circle</i> ${item}</li>`
          ).join('');
        } else {
          reqList.innerHTML = `<li class="text-muted">Standard industry qualifications apply.</li>`;
        }

      } catch (err) {
        console.error("Critical Page Error:", err);
      }
    }

    document.addEventListener('DOMContentLoaded', loadJobDetails);
  </script>
</body>
</html>